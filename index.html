<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>RutaPro · Plataforma CAP & Permiso C</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<script>
tailwind.config = {
  theme: {
    extend: {
      fontFamily: {
        display: ['"JetBrains Mono"', 'monospace'],
        body: ['"DM Sans"', 'sans-serif'],
      },
      colors: {
        asphalt: { 50:'#f7f7f8', 100:'#eeeef0', 200:'#d9d9de', 300:'#b5b5bf', 400:'#8e8e9b', 500:'#717180', 600:'#5b5b68', 700:'#4a4a55', 800:'#404048', 900:'#38383e', 950:'#1c1c1f' },
        signal: { amber:'#F59E0B', red:'#EF4444', green:'#10B981', blue:'#3B82F6' },
        road: { yellow:'#FBBF24', white:'#F8FAFC', orange:'#F97316' }
      }
    }
  }
}
</script>
<style>
  * { box-sizing: border-box; }
  body { font-family: 'DM Sans', sans-serif; background: #0f0f12; color: #e4e4e7; }
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: #1c1c1f; }
  ::-webkit-scrollbar-thumb { background: #404048; border-radius: 3px; }

  @keyframes slideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
  @keyframes pulse-glow { 0%,100% { box-shadow: 0 0 20px rgba(251,191,36,0.15); } 50% { box-shadow: 0 0 40px rgba(251,191,36,0.3); } }
  @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
  @keyframes confetti { 0%{transform:scale(0) rotate(0)} 50%{transform:scale(1.3) rotate(180deg)} 100%{transform:scale(1) rotate(360deg)} }

  .animate-slide-up { animation: slideUp 0.5s ease-out forwards; }
  .animate-fade { animation: fadeIn 0.4s ease-out; }
  .animate-shake { animation: shake 0.4s ease; }
  .animate-confetti { animation: confetti 0.5s ease-out; }
  .glow-card { animation: pulse-glow 3s ease-in-out infinite; }
  .glass { background: rgba(28,28,31,0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.06); }
  .danger-badge { background: linear-gradient(135deg, #991b1b, #dc2626); }
  .road-stripe { background: repeating-linear-gradient(90deg, #FBBF24 0px, #FBBF24 40px, transparent 40px, transparent 60px); height: 3px; }
  .progress-ring { transition: stroke-dashoffset 0.6s ease; }

  .option-btn { transition: all 0.2s ease; border: 2px solid rgba(255,255,255,0.08); }
  .option-btn:hover { border-color: rgba(251,191,36,0.4); background: rgba(251,191,36,0.05); }
  .option-btn.correct { border-color: #10B981 !important; background: rgba(16,185,129,0.12) !important; }
  .option-btn.wrong { border-color: #EF4444 !important; background: rgba(239,68,68,0.12) !important; }
  .option-btn.selected { border-color: #FBBF24; background: rgba(251,191,36,0.1); }
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef, useCallback, useMemo } = React;

// ─── ICONS (inline SVG) ───
const Icons = {
  Home: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"/><path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>,
  Play: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>,
  Book: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>,
  Chart: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>,
  AlertTriangle: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>,
  Download: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
  Upload: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
  Trophy: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
  Flame: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>,
  Check: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>,
  X: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
  Truck: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M15 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 13.52 8H14"/><circle cx="17" cy="18" r="2"/><circle cx="7" cy="18" r="2"/></svg>,
  RefreshCw: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
  Clock: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
  Shield: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/></svg>,
  Weight: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="5" r="3"/><path d="M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.23A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.46A2 2 0 0 0 17.48 8Z"/></svg>,
  Zap: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg>,
  Globe: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>,
  ExternalLink: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></svg>,
  GraduationCap: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z"/><path d="M22 10v6"/><path d="M6 12.5V16a6 3 0 0 0 12 0v-3.5"/></svg>,
  FileText: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>,
  Monitor: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></svg>,
  Sparkles: (p) => <svg xmlns="http://www.w3.org/2000/svg" width={p.size||20} height={p.size||20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/><path d="M20 3v4"/><path d="M22 5h-4"/><path d="M4 17v2"/><path d="M5 18H3"/></svg>,
};

// ─── QUESTION DATABASE (40 questions from PDFs) ───
const QUESTIONS = [
  // ── TACÓGRAFO (Zona de Peligro) ──
  { id:1, category:"Tacógrafo", danger:true, q:"¿Qué reglamento europeo regula los tiempos de conducción y descanso de los conductores profesionales?", options:["Reglamento (CE) 561/2006","Reglamento (UE) 165/2014","Reglamento (CEE) 3821/85","Directiva 2006/22/CE"], correct:0, explanation:"El Reglamento (CE) 561/2006 establece las normas sobre tiempos de conducción, pausas y períodos de descanso." },
  { id:2, category:"Tacógrafo", danger:true, q:"¿Qué reglamento regula específicamente el aparato tacógrafo digital?", options:["Reglamento (UE) 165/2014","Reglamento (CE) 561/2006","Real Decreto 1032/2007","Directiva 2007/46/CE"], correct:0, explanation:"El Reglamento (UE) 165/2014 sustituye al antiguo 3821/85 y regula el tacógrafo digital." },
  { id:3, category:"Tacógrafo", danger:true, q:"Tras 4 horas y media de conducción continuada, el conductor DEBE realizar una pausa de al menos:", options:["30 minutos","45 minutos","15 minutos","60 minutos"], correct:1, explanation:"Según el Reglamento 561/2006, tras 4,5 horas de conducción se exige una pausa mínima de 45 minutos." },
  { id:4, category:"Tacógrafo", danger:true, q:"¿Cuál es el tiempo máximo de conducción diaria según el Reglamento 561/2006?", options:["8 horas","9 horas, ampliable a 10 horas dos veces por semana","10 horas siempre","12 horas"], correct:1, explanation:"El límite diario es de 9 horas, pudiendo ampliarse a 10 horas un máximo de dos veces por semana." },
  { id:5, category:"Tacógrafo", danger:true, q:"¿Cuál es el tiempo máximo de conducción semanal?", options:["48 horas","56 horas","60 horas","45 horas"], correct:1, explanation:"El tiempo máximo de conducción semanal es de 56 horas, sin superar 90 horas en dos semanas consecutivas." },
  { id:6, category:"Tacógrafo", danger:true, q:"El descanso diario normal del conductor es de al menos:", options:["9 horas","10 horas","11 horas ininterrumpidas","8 horas"], correct:2, explanation:"El descanso diario normal es de al menos 11 horas ininterrumpidas dentro de cada período de 24 horas." },
  { id:7, category:"Tacógrafo", danger:true, q:"¿Qué sanción conlleva la manipulación fraudulenta del tacógrafo?", options:["Sanción leve","Sanción grave","Sanción muy grave","Solo una advertencia"], correct:2, explanation:"La manipulación fraudulenta del tacógrafo se considera infracción muy grave según la normativa." },

  // ── MASAS Y DIMENSIONES (Zona de Peligro) ──
  { id:8, category:"Masas y Dimensiones", danger:true, q:"¿Cuál es la masa máxima autorizada (MMA) de un camión rígido de 2 ejes?", options:["16 toneladas","18 toneladas","26 toneladas","12 toneladas"], correct:1, explanation:"Según el Anexo IX del Reglamento General de Vehículos, un camión de 2 ejes tiene una MMA de 18 toneladas." },
  { id:9, category:"Masas y Dimensiones", danger:true, q:"Un camión rígido de 3 ejes tiene una MMA general de:", options:["25 toneladas","26 toneladas","32 toneladas","18 toneladas"], correct:0, explanation:"La MMA general es 25 t, ampliable a 26 t con eje motor con neumáticos dobles y suspensión neumática." },
  { id:10, category:"Masas y Dimensiones", danger:true, q:"¿Cuál es la longitud máxima permitida de un camión rígido (incluida la carga)?", options:["10 metros","12 metros","16,50 metros","18,75 metros"], correct:1, explanation:"La longitud máxima de un camión rígido, incluida la carga, es de 12 metros." },
  { id:11, category:"Masas y Dimensiones", danger:true, q:"¿Cuál es la anchura máxima general de un camión?", options:["2,50 m","2,55 m","2,60 m","3,00 m"], correct:1, explanation:"La anchura máxima general es 2,55 m. Los vehículos acondicionados (isotermos) pueden alcanzar 2,60 m." },
  { id:12, category:"Masas y Dimensiones", danger:true, q:"La altura máxima general de un camión, incluida la carga, es de:", options:["3,50 metros","4,00 metros","4,50 metros","5,00 metros"], correct:1, explanation:"Como norma general, la altura máxima es de 4,00 m. Portavehículos y auxilio en carretera pueden llegar a 4,50 m." },
  { id:13, category:"Masas y Dimensiones", danger:true, q:"¿Cuál es la masa máxima por eje simple motor?", options:["10 toneladas","11,5 toneladas","13 toneladas","8 toneladas"], correct:1, explanation:"El eje simple motor tiene una masa máxima de 11,5 toneladas." },

  // ── TIEMPOS DE CONDUCCIÓN (Zona de Peligro) ──
  { id:14, category:"Tiempos de Conducción", danger:true, q:"¿Cuántas horas como máximo se puede conducir en dos semanas consecutivas?", options:["90 horas","96 horas","112 horas","80 horas"], correct:0, explanation:"El máximo acumulado en dos semanas consecutivas es de 90 horas de conducción." },
  { id:15, category:"Tiempos de Conducción", danger:true, q:"El descanso semanal normal tiene una duración mínima de:", options:["24 horas","36 horas","45 horas","48 horas"], correct:2, explanation:"El descanso semanal normal es de al menos 45 horas consecutivas." },
  { id:16, category:"Tiempos de Conducción", danger:true, q:"La pausa de 45 minutos tras 4,5 horas de conducción puede dividirse en:", options:["Dos pausas de 22,5 min","Una de 15 min seguida de otra de 30 min","Una pausa de 20 min y otra de 25 min","No puede dividirse"], correct:1, explanation:"Puede dividirse en una primera pausa de al menos 15 minutos y una segunda de al menos 30 minutos." },

  // ── CATEGORÍAS DE VEHÍCULOS ──
  { id:17, category:"Categorías de Vehículos", danger:false, q:"Los vehículos de categoría N son aquellos concebidos para:", options:["Transporte de personas","Transporte de mercancías","Remolques","Vehículos especiales"], correct:1, explanation:"La categoría N agrupa los vehículos de motor concebidos y fabricados principalmente para el transporte de mercancías." },
  { id:18, category:"Categorías de Vehículos", danger:false, q:"Un vehículo de categoría N2 tiene una masa máxima:", options:["No superior a 3,5 t","Superior a 3,5 t pero no a 12 t","Superior a 12 t","Superior a 7,5 t pero no a 16 t"], correct:1, explanation:"N2 = masa máxima superior a 3,5 t pero no superior a 12 t." },
  { id:19, category:"Categorías de Vehículos", danger:false, q:"Un remolque de categoría O4 tiene una masa máxima:", options:["Superior a 3,5 t pero no a 10 t","Superior a 10 toneladas","No superior a 0,75 t","Superior a 0,75 t pero no a 3,5 t"], correct:1, explanation:"O4 = remolques con masa máxima superior a 10 toneladas." },
  { id:20, category:"Categorías de Vehículos", danger:false, q:"¿Qué categoría corresponde a un vehículo N1?", options:["Camión pesado MMA > 12 t","Vehículo de mercancías MMA ≤ 3,5 t","Autobús con más de 8 plazas","Remolque ligero"], correct:1, explanation:"N1 = vehículos para transporte de mercancías con MMA no superior a 3,5 toneladas." },

  // ── SISTEMAS DE SEGURIDAD ──
  { id:21, category:"Sistemas de Seguridad", danger:false, q:"¿Qué sistema evita el bloqueo de las ruedas durante la frenada?", options:["ESP","ABS","ASR","ACC"], correct:1, explanation:"El ABS (Sistema Antibloqueo de Frenado) evita que las ruedas se bloqueen al frenar." },
  { id:22, category:"Sistemas de Seguridad", danger:false, q:"¿Qué significa ESP en un vehículo industrial?", options:["Sistema de control de tracción","Sistema de estabilización del vehículo","Sistema de repartición de frenada","Sistema regulador de velocidad"], correct:1, explanation:"ESP = Electronic Stability Program, sistema de estabilización electrónica del vehículo." },
  { id:23, category:"Sistemas de Seguridad", danger:false, q:"El sistema AEBS (Advanced Emergency Braking System) se activa para:", options:["Controlar la tracción en curvas","Repartir la frenada entre ejes","Realizar frenada de emergencia automática ante obstáculo","Regular la velocidad de crucero"], correct:2, explanation:"El AEBS es el sistema avanzado de frenado de urgencia que frena automáticamente ante una colisión inminente." },
  { id:24, category:"Sistemas de Seguridad", danger:false, q:"¿Qué función cumple el sistema EBS?", options:["Estabilización electrónica","Repartición electrónica de frenada entre ejes","Control de la tracción","Frenado antibloqueo"], correct:1, explanation:"El EBS (Electronic Braking System) reparte electrónicamente la frenada entre los diferentes ejes del vehículo." },
  { id:25, category:"Sistemas de Seguridad", danger:false, q:"El ASR (Anti-Slip Regulation) es un sistema de:", options:["Control de tracción","Frenado de emergencia","Estabilidad en curva","Gestión de carril"], correct:0, explanation:"El ASR controla la tracción, evitando que las ruedas motrices patinen al acelerar." },

  // ── CAP ──
  { id:26, category:"CAP", danger:false, q:"¿Cuál es la duración total de la cualificación inicial ordinaria del CAP para mercancías?", options:["140 horas","200 horas","244 horas","280 horas"], correct:2, explanation:"Según el programa TMVI21, la cualificación inicial ordinaria del CAP tiene una duración de 244 horas." },
  { id:27, category:"CAP", danger:false, q:"¿Qué Real Decreto regula actualmente la cualificación inicial y formación continua del CAP?", options:["RD 1032/2007","RD 284/2021","RD 818/2009","RD 2484/1994"], correct:1, explanation:"El Real Decreto 284/2021 regula actualmente la cualificación inicial y formación continua del CAP." },
  { id:28, category:"CAP", danger:false, q:"La evaluación del CAP se expresa en términos de:", options:["Numérica del 1 al 10","Apto / No Apto","Aprobado / Suspenso con nota","Porcentaje de aciertos"], correct:1, explanation:"La puntuación final del CAP se expresa en términos de Apto / No Apto." },
  { id:29, category:"CAP", danger:false, q:"¿Cuántas horas de conducción efectiva incluye el módulo de optimización de consumo de carburante del CAP?", options:["2 horas","3 horas","4 horas","5 horas"], correct:2, explanation:"Según el programa TMVI21, la parte de optimización de consumo incluye 4 horas de conducción efectiva." },

  // ── PERMISOS DE CONDUCCIÓN ──
  { id:30, category:"Permisos", danger:false, q:"El permiso de conducción C1 habilita para conducir vehículos de mercancías con MMA:", options:["Superior a 3.500 kg hasta 7.500 kg","Superior a 7.500 kg","Hasta 3.500 kg","Sin límite de masa"], correct:0, explanation:"El permiso C1 cubre vehículos cuya MMA es superior a 3.500 kg pero no excede de 7.500 kg." },
  { id:31, category:"Permisos", danger:false, q:"¿Qué edad mínima se requiere para obtener el permiso C?", options:["18 años","21 años","23 años","25 años"], correct:1, explanation:"Se requiere tener 21 años cumplidos para obtener el permiso C." },
  { id:32, category:"Permisos", danger:false, q:"El permiso C+E habilita para conducir:", options:["Solo camiones rígidos","Conjuntos de vehículo C + remolque de MMA > 750 kg","Solo vehículos articulados de hasta 7,5 t","Autobuses articulados"], correct:1, explanation:"C+E permite conducir un vehículo de categoría C con un remolque cuya MMA supere los 750 kg." },

  // ── CADENA CINEMÁTICA ──
  { id:33, category:"Cadena Cinemática", danger:false, q:"¿Dónde se encuentra la zona óptima de utilización del cuentarrevoluciones para ahorrar combustible?", options:["En la zona roja (máximas RPM)","En la zona verde (par máximo)","Por debajo de ralentí","En punto muerto"], correct:1, explanation:"La zona verde del cuentarrevoluciones corresponde al par máximo del motor, donde el consumo es más eficiente." },
  { id:34, category:"Cadena Cinemática", danger:false, q:"¿Qué son los ralentizadores en un camión?", options:["Sistemas de aceleración rápida","Sistemas de frenado secundario/retardación","Reguladores de temperatura","Sistemas de dirección asistida"], correct:1, explanation:"Los ralentizadores son sistemas de frenado secundario que ayudan a retardar el vehículo sin usar los frenos de servicio." },

  // ── CARGA Y ESTIBA ──
  { id:35, category:"Carga y Estiba", danger:false, q:"¿Qué consecuencia tiene la sobrecarga por eje?", options:["Solo mayor consumo de combustible","Inestabilidad del vehículo, desgaste irregular y sanción","Mejora la tracción","No afecta a la conducción"], correct:1, explanation:"La sobrecarga por eje compromete la estabilidad, produce desgaste irregular de neumáticos y conlleva sanciones." },
  { id:36, category:"Carga y Estiba", danger:false, q:"El centro de gravedad de la carga debe situarse:", options:["Lo más alto posible","Lo más bajo y centrado posible","En la parte trasera","No importa su posición"], correct:1, explanation:"Un centro de gravedad bajo y centrado mejora la estabilidad del vehículo y reduce el riesgo de vuelco." },
  { id:37, category:"Carga y Estiba", danger:false, q:"Las correas de estiba deben verificarse:", options:["Solo al cargar","Antes de cada viaje y periódicamente durante el trayecto","Una vez al año","Solo si la carga se mueve"], correct:1, explanation:"Las correas de estiba deben verificarse antes de la salida y regularmente durante el transporte." },

  // ── EMERGENCIAS Y PRL ──
  { id:38, category:"Emergencias y PRL", danger:false, q:"En caso de accidente, ¿cuál es el orden correcto de actuación (protocolo PAS)?", options:["Socorrer, Proteger, Avisar","Proteger, Avisar, Socorrer","Avisar, Proteger, Socorrer","Socorrer, Avisar, Proteger"], correct:1, explanation:"El protocolo PAS es: Proteger la zona, Avisar a los servicios de emergencia y Socorrer a los heridos." },
  { id:39, category:"Emergencias y PRL", danger:false, q:"¿Cuál es el principal factor de riesgo de accidente en conductores profesionales?", options:["Exceso de velocidad exclusivamente","Fatiga y somnolencia","Fallos mecánicos","Condiciones meteorológicas"], correct:1, explanation:"La fatiga y somnolencia es el principal factor de riesgo, directamente relacionado con el incumplimiento de tiempos de descanso." },
  { id:40, category:"Emergencias y PRL", danger:false, q:"El ciclo básico actividad/reposo es fundamental para:", options:["Reducir el consumo de combustible","Prevenir la fatiga y el estrés del conductor","Mejorar la imagen de marca","Cumplir el contrato de transporte"], correct:1, explanation:"El ciclo actividad/reposo es crucial para mantener la aptitud física y mental del conductor y prevenir la fatiga." },

  // ── EXAMEN REAL CAP MERCANCÍAS TIPO 1 — 31/01/2026 (100 preguntas) ──
  { id:41, category:"Dinámica del Vehículo", danger:false, q:"Cuando la trayectoria es más cerrada que la que debería realizar, el camión:", options:["Derrapa","Se balancea","Subvira","Sobrevira"], correct:3, explanation:"Sobrevirar significa que el vehículo gira más de lo que el conductor pretende, describiendo una trayectoria más cerrada." },
  { id:42, category:"Carga y Estiba", danger:false, q:"En camiones de caja abierta, ¿dónde debe situarse la carga para reducir la resistencia del aire?", options:["En la parte trasera de la caja","En la parte delantera de la caja","Lo más centrada posible en la caja","Lo más elevada posible"], correct:1, explanation:"Colocar la carga en la parte delantera reduce la resistencia aerodinámica al no exponer superficie frontal al viento." },
  { id:43, category:"Transporte y Regulación", danger:false, q:"Los vehículos oficiales de transporte de mercancías que utilizan los órganos de la Administración:", options:["Necesitan autorización de transporte público","Necesitan autorización de transporte privado particular","Necesitan autorización de transporte privado complementario","Están exentos de autorización de transporte"], correct:3, explanation:"Los vehículos utilizados por órganos de la Administración están exentos de la obligación de disponer de autorización de transporte." },
  { id:44, category:"Dinámica del Vehículo", danger:false, q:"¿Qué son los pares de las ruedas y pares de inercia?", options:["Fuerzas que intervienen sobre el eje vertical del camión","Fuerzas que intentan conservar el sentido de giro que llevan las ruedas","Fuerzas que intervienen sobre el eje horizontal del camión","Fuerzas principalmente de aceleración"], correct:1, explanation:"Los pares de inercia son fuerzas giroscópicas que tienden a mantener el sentido de giro de las ruedas." },
  { id:45, category:"Cadena Cinemática", danger:false, q:"La elección de la relación correcta de la caja de cambios de un camión durante la marcha depende:", options:["Del perfil de la carretera","Del tipo de neumáticos","De la experiencia del conductor","Del rozamiento mecánico"], correct:0, explanation:"La selección de marchas debe adaptarse al perfil de la carretera (pendientes, llano, bajadas) para optimizar el rendimiento." },
  { id:46, category:"Dinámica del Vehículo", danger:false, q:"La forma en que la inclinación del terreno en forma de pendiente afecta al movimiento de un camión se denomina:", options:["Fuerza termotecnia lateral","Balanceo","Resistencia a la aceleración","Resistencia a la pendiente"], correct:3, explanation:"La resistencia a la pendiente es la fuerza gravitatoria que se opone al movimiento del vehículo en una subida." },
  { id:47, category:"Carga y Estiba", danger:false, q:"¿Qué supone un incremento de la altura del centro de gravedad del vehículo?", options:["Un incremento de la estabilidad","Menores probabilidades de vuelco","Una reducción del riesgo en curvas","Un incremento de la inestabilidad con mayores probabilidades de vuelco"], correct:3, explanation:"A mayor altura del centro de gravedad, mayor riesgo de vuelco e inestabilidad, especialmente en curvas." },
  { id:48, category:"Carga y Estiba", danger:false, q:"Una buena estiba requiere que la carga sea colocada:", options:["De forma longitudinal a la caja del vehículo","Con espacios de al menos cuatro centímetros entre bultos","Con espacios de al menos un centímetro entre bultos","Para ser transportada con un máximo de seguridad para el personal del vehículo"], correct:3, explanation:"El objetivo principal de la estiba es garantizar la máxima seguridad durante el transporte." },
  { id:49, category:"Dinámica del Vehículo", danger:false, q:"¿Cuál de las siguientes fuerzas interviene en un camión?", options:["La fuerza de adherencia","La fuerza mayor","La fuerza menor","La fuerza nula"], correct:0, explanation:"La fuerza de adherencia es la que permite que los neumáticos se agarren al pavimento, fundamental para la tracción y el frenado." },
  { id:50, category:"Transporte y Regulación", danger:false, q:"Según el Reglamento (CE) 1/2005, no son aptos para el transporte de animales:", options:["Perros y gatos con menos de 6 meses","Cérvidos en fase de mudar la cornamenta","Terneros con menos de 3 meses","Todo animal capaz de moverse por sí solo"], correct:1, explanation:"Los cérvidos en fase de mudar la cornamenta no son aptos para el transporte por el estrés y riesgo de lesiones." },
  { id:51, category:"Transporte y Regulación", danger:false, q:"¿Cuáles son las funciones propias del gerente de una empresa de transporte de mercancías?", options:["Distribuir las órdenes de ruta","Planificación y representación de la empresa","Archivar la documentación","Conducir el vehículo y determinar el itinerario"], correct:1, explanation:"El gerente se encarga de la planificación estratégica y la representación de la empresa." },
  { id:52, category:"Transporte y Regulación", danger:false, q:"El convenio CMR se aplicará a los transportes efectuados:", options:["En ferrocarril entre dos estados signatarios","Por vía navegable entre dos países signatarios","Por vehículos de carretera entre dos países, uno al menos signatario","Por cualquiera de los sistemas anteriores"], correct:2, explanation:"El Convenio CMR se aplica exclusivamente al transporte por carretera entre dos países cuando al menos uno es signatario." },
  { id:53, category:"Dinámica del Vehículo", danger:false, q:"¿Qué es una guiñada?", options:["Giro sobre el eje longitudinal","Giro sobre el eje transversal","Giro sobre el eje central","Giro sobre el eje vertical"], correct:3, explanation:"La guiñada es el movimiento de giro del vehículo sobre su eje vertical (yaw). El balanceo es sobre el longitudinal y el cabeceo sobre el transversal." },
  { id:54, category:"Carga y Estiba", danger:false, q:"Las cargas formadas por bloques pesados o muy pesados, ¿en qué parte de la batea deben colocarse?", options:["Lo más cercano a la cabina","En la parte central","Encima de los ejes","En cualquier parte"], correct:2, explanation:"Los bloques pesados deben colocarse encima de los ejes para distribuir el peso correctamente y no sobrecargar ningún punto." },
  { id:55, category:"Transporte y Regulación", danger:false, q:"¿Qué se entiende por transporte de mercancías por cuenta ajena?", options:["El que realiza personal asalariado","La prestación de servicios de transporte a terceros","El que se realiza con vehículos alquilados","El realizado por personal no profesional"], correct:1, explanation:"El transporte por cuenta ajena es la prestación de servicios de transporte a terceros mediante precio." },
  { id:56, category:"Carga y Estiba", danger:false, q:"¿Qué ventaja tienen los cables metálicos de fibra de acero frente a las cinchas?", options:["Son más flexibles","Son más económicos","Son más resistentes a la climatología","Tienen mayor resistencia"], correct:3, explanation:"Los cables de acero ofrecen mayor resistencia a la tracción que las cinchas textiles." },
  { id:57, category:"Masas y Dimensiones", danger:true, q:"Para poder calcular la carga útil de un camión es necesario:", options:["Sumar su MMA a su TARA","Restar la TARA de su MMA","Restar la MMA de la TARA","Cargar el vehículo en una báscula"], correct:1, explanation:"Carga útil = MMA - TARA. Se resta el peso del vehículo vacío de la masa máxima autorizada." },
  { id:58, category:"Transporte y Regulación", danger:false, q:"Las autorizaciones bilaterales de transporte internacional denominadas de entrada en vacío son válidas para:", options:["Entrar al país vacío y salir con carga","Atravesar el país vacío","Llevar mercancía al país y regresar vacío a España","No existe esta modalidad"], correct:0, explanation:"La autorización de entrada en vacío permite entrar al país sin carga y salir cargado." },
  { id:59, category:"Transporte y Regulación", danger:false, q:"En un contrato CMR, el transportista responde de los daños sufridos por la mercancía:", options:["Desde su recepción hasta su entrega","Desde que el vehículo inicia la marcha hasta la entrega","Desde que inicia la marcha hasta la llegada a destino","No responde, para eso hay seguro"], correct:0, explanation:"Según el Convenio CMR, la responsabilidad del transportista abarca desde la recepción de la mercancía hasta su entrega." },
  { id:60, category:"Transporte y Regulación", danger:false, q:"¿Cuál se considera mercancía de la Unión a efectos aduaneros?", options:["La obtenida totalmente en el territorio aduanero sin mercancías importadas","La importada y despachada a libre práctica","La obtenida a partir de las anteriores","Todas las respuestas son correctas"], correct:3, explanation:"Las tres categorías descritas constituyen mercancía de la Unión a efectos aduaneros." },
  { id:61, category:"Transporte y Regulación", danger:false, q:"En tránsito de la Unión con garantía individual, la garantía cubrirá:", options:["El importe íntegro de la deuda aduanera","El 75% de la deuda aduanera","El 50% de la deuda aduanera","El 25% de la deuda aduanera"], correct:0, explanation:"La garantía individual debe cubrir el importe íntegro de la deuda aduanera que pueda originarse." },
  { id:62, category:"Transporte y Regulación", danger:false, q:"Señale la afirmación correcta sobre el Convenio TIR:", options:["Es imprescindible que parte del viaje se haga por carretera","Es imprescindible que parte se haga por ferrocarril","Es imprescindible que parte se haga en barco","A y B son correctas"], correct:0, explanation:"Para que el Convenio TIR sea aplicable, al menos una parte del trayecto debe realizarse por carretera." },
  { id:63, category:"Transporte y Regulación", danger:false, q:"En la UE, ¿cuál es el límite de responsabilidad de las asociaciones garantes por cada cuaderno TIR?", options:["50.000 euros","60.000 euros","75.000 euros","100.000 euros"], correct:1, explanation:"El límite de responsabilidad por cuaderno TIR en la UE es de 60.000 euros." },
  { id:64, category:"Transporte y Regulación", danger:false, q:"¿Cuál es el número mínimo de componentes de un consejo de administración de una sociedad anónima?", options:["1","2","3","5"], correct:2, explanation:"El consejo de administración de una SA requiere un mínimo de 3 miembros." },
  { id:65, category:"Transporte y Regulación", danger:false, q:"En un transporte de animales vivos, ¿qué documento debe ir a bordo del vehículo?", options:["Documentación del propietario de los animales","Autorización del medio de transporte","Documentación del origen de los animales","Todas las respuestas son correctas"], correct:3, explanation:"Debe llevarse documentación del propietario, autorización del medio de transporte y documentación del origen." },
  { id:66, category:"Tacógrafo", danger:true, q:"Los datos que registra un tacógrafo analógico se recogen en documentos llamados:", options:["Cuadro de servicio","Hojas de registro","Tarjetas de empresa","Libro de ruta"], correct:1, explanation:"Las hojas de registro (discos) son los documentos donde el tacógrafo analógico registra las actividades del conductor." },
  { id:67, category:"Tacógrafo", danger:true, q:"La descarga de datos de las tarjetas de tacógrafo de los conductores deberá hacerse, al menos:", options:["Una vez al año","Cada 28 días con actividad registrada","Cada 31 días con actividad registrada","Una vez por semana"], correct:1, explanation:"Los datos de la tarjeta del conductor deben descargarse al menos cada 28 días en los que haya actividad registrada." },
  { id:68, category:"Emergencias y PRL", danger:false, q:"Al prestar ayuda a un herido inconsciente en un accidente, debemos:", options:["Reanimarlo moviéndolo ligeramente","Mantenerle las vías respiratorias abiertas","Trasladarlo cuanto antes al hospital","Todas son falsas"], correct:1, explanation:"Ante un herido inconsciente, lo prioritario es mantener las vías respiratorias abiertas para evitar la asfixia." },
  { id:69, category:"Tiempos de Conducción", danger:true, q:"Según el Reg. 561/2006, 'el tiempo acumulado total de conducción entre el final de un período de descanso diario y el principio del siguiente' se refiere a:", options:["Tiempo semanal de conducción","Tiempo diario de conducción","Conducción ininterrumpida","Conducción bisemanal"], correct:1, explanation:"Esa definición corresponde exactamente al concepto de tiempo diario de conducción según el Reglamento 561/2006." },
  { id:70, category:"Tiempos de Conducción", danger:true, q:"El exceso superior a dos horas sobre los tiempos máximos de conducción diaria se considera infracción:", options:["Muy grave","Grave","Leve","No se considera infracción"], correct:0, explanation:"Un exceso de más de 2 horas sobre el máximo de conducción diaria constituye infracción muy grave." },
  { id:71, category:"Emergencias y PRL", danger:false, q:"Para el levantamiento manual de pesos en posición sentado, el INSHT recomienda no superar:", options:["5 kilos","15 kilos","25 kilos","50 kilos"], correct:0, explanation:"El INSHT recomienda un máximo de 5 kg para manipulación manual de cargas en posición sentado." },
  { id:72, category:"CAP", danger:false, q:"¿Para qué conductores NO es necesario el CAP?", options:["Conductores de vehículos con velocidad máx. autorizada de 90 km/h","Conductores de Fuerzas Armadas, protección civil, bomberos y FCSE","Conductores de autobuses con más de 45 plazas","Conductores de camiones con MMA > 10.000 kg"], correct:1, explanation:"Los conductores de vehículos de las Fuerzas Armadas, protección civil, bomberos y FCSE están exentos del CAP." },
  { id:73, category:"Tacógrafo", danger:true, q:"Los transportes con vehículos de velocidad máxima autorizada inferior a 40 km/h:", options:["Exentos de tacógrafo si transporte privado","Deben usar tacógrafo en transporte agrícola","Exentos de espejos retrovisores exteriores","Están exentos del uso del tacógrafo"], correct:3, explanation:"Los vehículos cuya velocidad máxima autorizada no supere los 40 km/h están exentos de la obligación de tacógrafo." },
  { id:74, category:"Emergencias y PRL", danger:false, q:"Para que la declaración amistosa de accidente sea válida, debe estar firmada por:", options:["Los conductores y los testigos","Los conductores implicados en el accidente","Solo el conductor que se declare culpable","Los titulares de los vehículos o sus representantes"], correct:1, explanation:"La declaración amistosa debe ser firmada por los conductores implicados en el accidente." },
  { id:75, category:"Tiempos de Conducción", danger:true, q:"El período de descanso semanal normal según la normativa comunitaria será:", options:["Como máximo, 45 horas","Como mínimo, 54 horas","Al menos, 45 horas","Al menos, 54 horas"], correct:2, explanation:"El descanso semanal normal es de al menos 45 horas consecutivas." },
  { id:76, category:"Consumo y Eficiencia", danger:false, q:"Una presión en los neumáticos de 2 bares por debajo de lo fijado por el fabricante:", options:["No influye en el consumo","Disminuye el riesgo de reventón","Incide en un consumo extra de carburante","Supone un ahorro de carburante"], correct:2, explanation:"Los neumáticos con presión baja aumentan la resistencia a la rodadura y, por tanto, el consumo de combustible." },
  { id:77, category:"Emergencias y PRL", danger:false, q:"Para que se considere accidente de trabajo, este debe tener lugar:", options:["Exclusivamente en el lugar de trabajo","En el lugar de trabajo o 'in itinere'","Solo en el lugar de trabajo o al ir a trabajar","Solo en el lugar de trabajo o al volver"], correct:1, explanation:"El accidente de trabajo incluye tanto el ocurrido en el lugar de trabajo como el ocurrido in itinere (ida y vuelta al trabajo)." },
  { id:78, category:"Emergencias y PRL", danger:false, q:"En la actividad de transporte, ¿qué causa con mayor frecuencia lumbalgias y cervicalgias?", options:["Mantenimiento prolongado de posturas forzadas","Sobrecarga de la maquinaria de manipulación","Utilización de maquinaria inadecuada","Mal estado de los elementos de sujeción"], correct:0, explanation:"Las posturas forzadas mantenidas durante largo tiempo son la principal causa de lumbalgias y cervicalgias en conductores." },
  { id:79, category:"Tacógrafo", danger:true, q:"Los vehículos exentos de tacógrafo por normativa española, ¿deben usarlo en los recorridos en vacío antes o después del servicio exento?", options:["Siempre","Nunca","No si el recorrido en vacío es de 5 km","Solo si el recorrido en vacío supera 5 km"], correct:1, explanation:"Si el vehículo está exento del tacógrafo para un servicio, los recorridos en vacío vinculados a ese servicio también están exentos." },
  { id:80, category:"Emergencias y PRL", danger:false, q:"Ante la caída de carga sobre la vía, ¿qué NO debe hacerse?", options:["Señalizar el obstáculo","Avisar del peligro al resto de usuarios","Dar cuenta a los servicios de auxilio","Abandonar la zona inmediatamente"], correct:3, explanation:"Nunca se debe abandonar la zona sin señalizar ni asegurar. Se debe proteger, avisar y señalizar." },
  { id:81, category:"Emergencias y PRL", danger:false, q:"¿Qué actuación NO es una medida preventiva para evitar un incendio?", options:["Revisar el estado de los frenos","Accionar la luz de emergencia","Revisar los extintores y situarlos accesiblemente","Mantener en buen estado la mecánica"], correct:1, explanation:"Accionar la luz de emergencia no es una medida de prevención de incendios, sino una medida de señalización." },
  { id:82, category:"Emergencias y PRL", danger:false, q:"¿Cómo se denomina también la declaración amistosa de accidentes?", options:["Declaración amistosa de colisión","Parte regional de accidentes","Parte europeo de accidente","Papel amistoso de accidente"], correct:2, explanation:"La declaración amistosa de accidente se conoce también como Parte Europeo de Accidente (PEA)." },
  { id:83, category:"Emergencias y PRL", danger:false, q:"Sobre el auxilio a heridos, ¿cuál es INCORRECTA?", options:["Solo mover al herido fuera del vehículo si hay riesgo grave","Si se le puede atender dentro del vehículo, no sacarlo","La primera actuación es siempre sacarlo del lugar del accidente","No mover a heridos salvo peligro inminente"], correct:2, explanation:"Es incorrecto sacar siempre al herido del lugar del accidente. Solo se mueve en caso de peligro inminente (incendio, etc.)." },
  { id:84, category:"Cadena Cinemática", danger:false, q:"Un kilovatio de potencia equivale a:", options:["1,36 caballos de vapor","2,5 caballos de vapor","1,10 caballos de vapor","2,25 caballos de vapor"], correct:0, explanation:"1 kW = 1,36 CV (caballos de vapor). Es la equivalencia estándar." },
  { id:85, category:"Tiempos de Conducción", danger:true, q:"¿Cuántas horas como máximo puede conducir un conductor en 2 semanas consecutivas?", options:["120 horas","90 horas","80 horas","60 horas"], correct:1, explanation:"El máximo acumulado de conducción en dos semanas consecutivas es de 90 horas según el Reg. 561/2006." },
  { id:86, category:"Tiempos de Conducción", danger:true, q:"Los períodos de descanso semanal que empiezan en una semana y terminan en la siguiente pueden computarse:", options:["En las dos semanas","Solo en la primera semana","Solo en la segunda semana","En cualquiera de ellas, pero no en ambas"], correct:3, explanation:"Un descanso semanal a caballo entre dos semanas solo puede computarse en una de ellas, no en ambas." },
  { id:87, category:"Tacógrafo", danger:true, q:"Un vehículo con tacógrafo analógico cuando debería llevar digital, ¿comete infracción?", options:["Sí, se considera carencia de aparato de control","No, puesto que lleva un tacógrafo","Sí, pero solo en transporte de mercancías","Sí, pero solo en transporte de viajeros"], correct:0, explanation:"Llevar tacógrafo analógico cuando es obligatorio el digital se equipara a carencia de aparato de control." },
  { id:88, category:"Tacógrafo", danger:true, q:"La alteración del funcionamiento del aparato de control para que los registros no correspondan a la realidad es infracción de:", options:["Manipulación del aparato de control","Carencia de tacógrafo","Minoración del descanso","Mal uso de la hoja de registro"], correct:0, explanation:"Alterar el funcionamiento del tacógrafo para falsear registros constituye infracción por manipulación del aparato de control." },
  { id:89, category:"Transporte y Regulación", danger:false, q:"La marca de una empresa de transporte:", options:["Representa su principal pasivo","No promete expectativas de satisfacción","No identifica a la empresa","Permite diferenciar sus servicios de los de la competencia"], correct:3, explanation:"La marca es un activo que permite diferenciarse de la competencia y genera expectativas de calidad." },
  { id:90, category:"Emergencias y PRL", danger:false, q:"¿Cuál de los siguientes es un accidente laboral que afecta a los trabajadores de empresas de transporte?", options:["Sobreesfuerzos","Caída de personas al mismo nivel","Exposición continuada a vibraciones","Todas las respuestas son correctas"], correct:3, explanation:"Los sobreesfuerzos, las caídas y la exposición a vibraciones son todos accidentes laborales frecuentes en el transporte." },
  { id:91, category:"CAP", danger:false, q:"¿En qué consiste la modalidad ordinaria de obtención del CAP?", options:["Curso de 200 horas + examen","Curso de 300 horas","Curso de 280 horas + examen","Ninguna es correcta"], correct:2, explanation:"La cualificación inicial ordinaria del CAP consiste en un curso de 280 horas y la posterior superación de un examen." },
  { id:92, category:"Transporte y Regulación", danger:false, q:"Según la LRCSCVM, un vehículo tiene estacionamiento habitual en España cuando:", options:["Su propietario reside más de 183 días en España","Tiene matrícula española","Tiene matrícula UE y su propietario reside mayormente en España","Su propietario es español"], correct:1, explanation:"Un vehículo tiene su estacionamiento habitual en España cuando tiene matrícula española." },
  { id:93, category:"Cadena Cinemática", danger:false, q:"Cuando se habla de ralentizadores se está haciendo referencia:", options:["Al retárder, por ejemplo","A un sistema que regula el ralentí del motor","A un tipo de freno de compresión","A un tipo de freno de expansión"], correct:0, explanation:"Los ralentizadores (como el retárder) son sistemas auxiliares de frenado que reducen la velocidad sin usar los frenos de servicio." },
  { id:94, category:"Tacógrafo", danger:true, q:"El tacógrafo digital funciona correctamente desde:", options:["Que se introduce la primera tarjeta de conductor","Que sale de fábrica","La activación, cuando el registro y almacenamiento están operativos","Que se hace la primera descarga de datos"], correct:2, explanation:"El tacógrafo digital funciona plenamente desde su activación, momento en que todas las funciones quedan operativas." },
  { id:95, category:"Dinámica del Vehículo", danger:false, q:"La energía cinética de un vehículo es igual a:", options:["Su masa por su velocidad","Su masa por el cuadrado de su velocidad","La mitad de su masa por su velocidad","La mitad de su masa por el cuadrado de su velocidad"], correct:3, explanation:"Ec = ½mv². La energía cinética es la mitad de la masa multiplicada por el cuadrado de la velocidad." },
  { id:96, category:"Dinámica del Vehículo", danger:false, q:"¿En qué se expresa la energía cinética de un vehículo?", options:["En julios","En caballos de vapor","En newtons","En kilómetros por hora"], correct:0, explanation:"La energía cinética se mide en julios (J), que es la unidad del Sistema Internacional para la energía." },
  { id:97, category:"Sistemas de Seguridad", danger:false, q:"Si el vehículo está dotado de ABS, ¿cómo actúa durante una frenada?", options:["Deteniendo inmediatamente el vehículo en vía mojada","Deteniendo inmediatamente el vehículo con nieve","Evitando bloqueo de ruedas solo en vía mojada","Evitando que las ruedas se bloqueen en cualquier estado de la vía"], correct:3, explanation:"El ABS evita el bloqueo de las ruedas independientemente del estado de la calzada (seca, mojada o helada)." },
  { id:98, category:"Transporte y Regulación", danger:false, q:"Según la LRCSCVM, ¿están cubiertos por el seguro los daños sufridos por bienes de parientes en tercer grado del conductor?", options:["Sí, en todos los casos","Sí, si no se encuentran en el vehículo","Sí, salvo hermanos, padres o hijos","No, en ningún caso"], correct:0, explanation:"Los daños a bienes de parientes en tercer grado del conductor están cubiertos por el seguro obligatorio." },
  { id:99, category:"Cadena Cinemática", danger:false, q:"Si las válvulas de escape de los cilindros no se cierran en el momento adecuado:", options:["Aumentará el consumo de carburante","Disminuirá el consumo","Disminuirá la presión en el grupo cónico","El humo será verde azulado"], correct:0, explanation:"El mal cierre de las válvulas de escape provoca pérdida de eficiencia y aumento del consumo de carburante." },
  { id:100, category:"Emergencias y PRL", danger:false, q:"En los accidentes laborales en la actividad de transporte:", options:["Solo interviene una única causa","Suelen confluir varias causas","La causa es siempre el conductor","Ninguna es correcta"], correct:1, explanation:"En los accidentes laborales del transporte suelen confluir múltiples causas (humanas, mecánicas, ambientales)." },
  { id:101, category:"Transporte y Regulación", danger:false, q:"El transporte por cuenta propia cuya actividad principal no es el transporte se denomina:", options:["Transporte privado productivo","Transporte empresarial privado","Transporte privado complementario","Transporte mercantil"], correct:2, explanation:"Cuando una empresa transporta sus propias mercancías como actividad accesoria, se denomina transporte privado complementario." },
  { id:102, category:"Tacógrafo", danger:true, q:"Un vehículo que transporta animales entre una granja y un mercado local está:", options:["Obligado a usar tacógrafo siempre","Obligado a usar tacógrafo digital si >10 km","Exento de tacógrafo si el recorrido no supera 100 km en línea recta","Exento siempre de usar tacógrafo"], correct:2, explanation:"El transporte de animales entre granjas y mercados locales está exento de tacógrafo si no supera los 100 km en línea recta." },
  { id:103, category:"Cadena Cinemática", danger:false, q:"La potencia de un motor se mide en:", options:["Caballos fiscales","Newtons","Kilómetros por hora","Kilovatios"], correct:3, explanation:"La potencia de un motor se mide en kilovatios (kW) en el Sistema Internacional." },
  { id:104, category:"Emergencias y PRL", danger:false, q:"¿Qué riesgo para la conducción aumenta cuando hay nieve en la calzada?", options:["Menor adherencia","Menor visibilidad","Ocultación de las señales","Todas las respuestas son correctas"], correct:3, explanation:"La nieve reduce la adherencia, disminuye la visibilidad y puede ocultar señales y marcas viales." },
  { id:105, category:"Tiempos de Conducción", danger:true, q:"El descanso diario en dos períodos (3h + 9h), ¿puede tomarse tantas veces como se quiera?", options:["Sí, pero siempre en ese orden","Solo dos veces por semana","Solo ocho veces al mes","Solo los conductores en equipo"], correct:0, explanation:"El descanso diario fraccionado de 3+9 horas puede realizarse sin límite de veces, siempre en ese orden (primero 3h, luego 9h)." },
  { id:106, category:"Consumo y Eficiencia", danger:false, q:"Sobre el coeficiente aerodinámico de un vehículo:", options:["No influye en la estabilidad","Cuanto mayor sea, mayor será su consumo","Cuanto mayor sea, mayor será su estabilidad","Será mejor cuanto mayor sea su Cx"], correct:1, explanation:"Un coeficiente aerodinámico (Cx) alto implica mayor resistencia al aire y por tanto mayor consumo de combustible." },
  { id:107, category:"Consumo y Eficiencia", danger:false, q:"Para que el consumo sea nulo circulando, además de no acelerar, es necesario:", options:["Tener marcha engranada y no pisar el embrague","Tener marcha engranada y pisar el embrague","Tener marcha engranada, con o sin embrague","Tener la palanca en punto muerto"], correct:0, explanation:"Con una marcha engranada y sin pisar el embrague ni acelerar, la inyección se corta y el consumo es cero (retención del motor)." },
  { id:108, category:"Consumo y Eficiencia", danger:false, q:"¿De qué depende, entre otros factores, el consumo de carburante?", options:["De la longitud del pistón","De la longitud del árbol de levas","De la longitud del cigüeñal","Del número de revoluciones del motor"], correct:3, explanation:"El consumo de carburante depende directamente del régimen de revoluciones del motor." },
  { id:109, category:"Consumo y Eficiencia", danger:false, q:"Dependiendo de la presión sobre el acelerador, el conductor puede:", options:["Reducir el ralentí del motor","Aumentar el ralentí del motor","Reducir el consumo de carburante","Reducir la relación de compresión"], correct:2, explanation:"Modulando la presión sobre el acelerador se puede reducir el consumo conduciendo de forma más eficiente." },
  { id:110, category:"Consumo y Eficiencia", danger:false, q:"¿Cuál es una buena medida para no aumentar el consumo de un vehículo pesado?", options:["Aumentar el coeficiente aerodinámico con alerones","Aumentar la presión de inflado de los neumáticos","Montar cajas de cambio automáticas","Mantener el filtro del aire limpio y sustituirlo según fabricante"], correct:3, explanation:"Un filtro de aire limpio asegura la correcta mezcla aire-combustible y evita el sobreconsumo." },
  { id:111, category:"Emergencias y PRL", danger:false, q:"¿Cuál es el orden correcto de actuaciones en caso de accidente de circulación?", options:["Preservar seguridad, solicitar ayuda, ayudar víctimas","Ayudar víctimas, solicitar ayuda, preservar seguridad","Ayudar víctimas, preservar seguridad, solicitar ayuda","Preservar seguridad, ayudar víctimas, solicitar ayuda"], correct:0, explanation:"El protocolo PAS es: Proteger (preservar seguridad), Avisar (solicitar ayuda) y Socorrer (ayudar a las víctimas)." },
  { id:112, category:"Emergencias y PRL", danger:false, q:"¿Qué secuelas graves pueden tener los traumatismos craneoencefálicos?", options:["Coma vegetativo","Discapacidad mental","Discapacidad física","Todas las respuestas son correctas"], correct:3, explanation:"Los TCE pueden causar coma vegetativo, discapacidad mental y física. Todas son secuelas posibles." },
  { id:113, category:"Tiempos de Conducción", danger:true, q:"En trabajo nocturno de trabajadores móviles no nocturnos, la jornada por cada 24 horas no podrá exceder de:", options:["Doce horas","Ocho horas","Diez horas","Nueve horas"], correct:2, explanation:"Para trabajadores móviles que realizan trabajo nocturno sin ser trabajadores nocturnos, el límite es de 10 horas por cada 24 horas." },
  { id:114, category:"Tacógrafo", danger:true, q:"¿Qué tipo de infracción constituye la manipulación de un tacógrafo digital?", options:["Leve","Grave","Muy grave","No constituye infracción"], correct:2, explanation:"La manipulación del tacógrafo digital con intención de alterar su funcionamiento es infracción muy grave." },
  { id:115, category:"CAP", danger:false, q:"¿En qué registro público se anota la obtención del CAP por un conductor?", options:["En ninguno","En el Registro de Empresas y Actividades de Transporte","En el Registro de Conductores de la DGT","En el Registro Mercantil"], correct:2, explanation:"El CAP se anota en el Registro de Conductores de la Dirección General de Tráfico." },
  { id:116, category:"Tacógrafo", danger:true, q:"¿Qué son las hojas de registro del tacógrafo?", options:["Documentos donde se registran los datos del tacógrafo analógico","Documentos técnicos del tacógrafo","Documentos de inspección del tacógrafo","Hojas de registro de movimientos de la carga"], correct:0, explanation:"Las hojas de registro (discos) son los soportes donde el tacógrafo analógico registra los datos de actividad del conductor." },
  { id:117, category:"Emergencias y PRL", danger:false, q:"Respecto del alcohol y la conducción, señale la correcta:", options:["No afecta si está bajo el límite legal","El alcohol con comida no se absorbe","Masticar café evita dar positivo","El conductor que ha bebido suele infravalorar el riesgo"], correct:3, explanation:"El alcohol reduce la percepción de riesgo. El conductor que ha bebido tiende a infravalorar el peligro." },
  { id:118, category:"Sistemas de Seguridad", danger:false, q:"¿Cuáles son los elementos del airbag?", options:["Cojín inflable, resorte mecánico y pretensor pirofórico","Cojín inflable, detector de impacto y resorte mecánico","Cojín inflable, pretensor pirofórico y sistema de inflado","Cojín inflable, detector de impacto y sistema de inflado"], correct:3, explanation:"El airbag se compone de un cojín inflable, un detector de impacto que activa el sistema y un generador de gas para el inflado." },
  { id:119, category:"Consumo y Eficiencia", danger:false, q:"¿Cuál de las siguientes circunstancias aumenta el consumo de carburante?", options:["El uso de aire acondicionado","No modificar la aerodinámica del vehículo","Revisión y sustitución del filtro del aire","Circular a velocidad moderada"], correct:0, explanation:"El aire acondicionado consume energía del motor, lo que incrementa el consumo de carburante." },
  { id:120, category:"Transporte y Regulación", danger:false, q:"Según la LRCSCVM, si un vehículo circula sin seguro puede acordarse:", options:["El precinto por cuatro meses","El depósito en domicilio del propietario por cuatro meses","El precinto por un mes","El depósito en lugar público por 15 días"], correct:0, explanation:"La ley prevé el precinto del vehículo por un período de hasta cuatro meses como medida cautelar." },
  { id:121, category:"Cadena Cinemática", danger:false, q:"La curva de potencia a carga parcial es:", options:["La que muestra la potencia pisando el acelerador al 25%","La que muestra la potencia al 50%","La que muestra la potencia al 75%","Todas las respuestas son correctas"], correct:3, explanation:"Las curvas a carga parcial representan la potencia a distintos niveles de acelerador: 25%, 50% y 75%." },
  { id:122, category:"Cadena Cinemática", danger:false, q:"¿A qué da lugar la potencia máxima del motor?", options:["Al máximo par motor","Al máximo de revoluciones del motor","A la mayor potencia en rueda","A un llenado medio del cilindro"], correct:2, explanation:"La potencia máxima del motor se traduce en la mayor potencia transmitida a las ruedas, permitiendo la velocidad máxima." },
  { id:123, category:"Sistemas de Seguridad", danger:false, q:"¿Qué elemento puede condicionar la frenada de un vehículo pesado?", options:["La carga transportada","La sujeción de la carga","La distribución de la carga","Todas las respuestas son correctas"], correct:3, explanation:"La cantidad, sujeción y distribución de la carga afectan directamente a la eficacia de la frenada." },
  { id:124, category:"Sistemas de Seguridad", danger:false, q:"¿Cómo actúa el sistema TCS sobre el motor?", options:["Incrementa la potencia en pendiente ascendente","Cuando las ruedas motrices patinan, reduce la potencia del motor","Reduce la potencia si detecta fallo de frenos","Todas son correctas"], correct:1, explanation:"El TCS (Control de Tracción) reduce la potencia del motor cuando detecta que las ruedas motrices patinan." },
  { id:125, category:"Sistemas de Seguridad", danger:false, q:"El sistema de ayuda a la conducción que mide la distancia de seguridad se conoce como:", options:["LKA","AEH","HMW","PCW"], correct:2, explanation:"HMW = Headway Monitoring Warning, sistema que mide la distancia de seguridad con el vehículo precedente." },
  { id:126, category:"Sistemas de Seguridad", danger:false, q:"El dispositivo ABS lleva a cabo la acción de:", options:["Detectar frenada de emergencia y corregir defectos","Medir distancia con vehículo delante","Sincronizar frenos en todas las ruedas","Si capta posible bloqueo de rueda, disminuye la fuerza de frenado sobre ella"], correct:3, explanation:"El ABS detecta el inminente bloqueo de cada rueda y reduce selectivamente la presión de frenado sobre ella." },
  { id:127, category:"Sistemas de Seguridad", danger:false, q:"¿Qué se consigue con el sistema EBS?", options:["Mejorar el inicio de movimiento en firmes deslizantes","Acortar la distancia de frenado","Incrementar la presión de frenado para evitar colisión","Disminuir el consumo de combustible"], correct:1, explanation:"El EBS (Electronic Braking System) optimiza la distribución de frenado entre ejes, acortando la distancia de frenado." },
  { id:128, category:"Sistemas de Seguridad", danger:false, q:"¿Cuándo NO es aconsejable utilizar el sistema TCS?", options:["Con calzada mojada","Con presión baja de neumáticos","Usando cadenas","Con el vehículo vacío"], correct:2, explanation:"Al usar cadenas, el TCS puede interferir con su funcionamiento ya que interpreta el deslizamiento de las cadenas como pérdida de tracción." },
  { id:129, category:"Sistemas de Seguridad", danger:false, q:"¿A qué sistema de ayuda corresponden las siglas LDW?", options:["Control del alumbrado","Alerta de salida de carril","Control de ángulo muerto","Alerta de colisión con peatones y ciclistas"], correct:1, explanation:"LDW = Lane Departure Warning, sistema de alerta de salida involuntaria de carril." },
  { id:130, category:"Sistemas de Seguridad", danger:false, q:"¿Cuándo actúa el sistema PCW?", options:["Cambio brusco de dirección a alta velocidad","Colisión inminente a baja velocidad con un peatón","Al iniciar conducción sin cinturón","Cuando una rueda motriz resbala"], correct:1, explanation:"PCW = Pedestrian Collision Warning, actúa en caso de colisión inminente con un peatón a baja velocidad." },
  { id:131, category:"Tiempos de Conducción", danger:true, q:"Según el Reg. 561/2006, ¿qué condición permite superar el máximo de conducción diaria?", options:["Finalizar servicio regular con exceso <30 min","Distancia al destino inferior a 100 km","Llegar a la residencia del conductor o centro de operaciones del empresario","Contar con autorización administrativa"], correct:2, explanation:"El conductor puede exceder el tiempo para llegar a un lugar de parada adecuado, como su residencia o el centro de operaciones." },
  { id:132, category:"Emergencias y PRL", danger:false, q:"¿Cuándo debe utilizarse el alumbrado del vehículo como regla general?", options:["En la circulación por túneles","En zonas sin preferencia de paso","En caso de aviso de obras en la vía","Todas las respuestas son correctas"], correct:0, explanation:"Como regla general obligatoria, el alumbrado debe utilizarse siempre en la circulación por túneles." },
  { id:133, category:"Emergencias y PRL", danger:false, q:"Cruzar una calzada sin mirar es:", options:["Infracción común en menores de 14 años","Infracción común en mayores de 14 años","Infracción común en todas las edades","Una conducta de riesgo, no una infracción"], correct:0, explanation:"Es una infracción que se comete con mayor frecuencia entre peatones menores de 14 años." },
  { id:134, category:"Emergencias y PRL", danger:false, q:"¿Los trastornos del ritmo circadiano pueden impedir obtener o prorrogar el permiso de conducción?", options:["Pueden impedir la obtención pero no la prórroga","Pueden impedir la prórroga pero no la obtención","Sí, o reducir su período de vigencia","En ningún caso"], correct:2, explanation:"Los trastornos del ritmo circadiano pueden impedir la obtención/prórroga o reducir el período de vigencia del permiso." },
  { id:135, category:"Emergencias y PRL", danger:false, q:"La protección de la zona de un accidente incluye comprobar:", options:["Que no haya riesgo de incendio","Que no haya heridos","Que no haya muertos","Todas las respuestas son correctas"], correct:0, explanation:"En la fase de Proteger, lo prioritario es verificar que no existen riesgos añadidos como incendio o derrames." },
  { id:136, category:"Emergencias y PRL", danger:false, q:"¿Cuál es un modo de apagar un incendio por eliminación del comburente?", options:["Recubrir con espuma el combustible que arde","Apartar materiales combustibles próximos","Refrigerar el combustible próximo al que arde","Todas son correctas"], correct:0, explanation:"La espuma recubre el combustible y aísla el comburente (oxígeno), extinguiendo el fuego por sofocación." },
  { id:137, category:"CAP", danger:false, q:"Las empresas autorizadas para impartir cursos del CAP se denominan:", options:["Centros CAP","Empresas CAP","Autoescuelas","Centros de formación de conductores"], correct:1, explanation:"La denominación legal es 'Empresas CAP', según el RD 284/2021." },
  { id:138, category:"CAP", danger:false, q:"¿Qué tipo de control debe realizar la Administración sobre una empresa CAP?", options:["Comprobar periódicamente que sigue cumpliendo las condiciones","Solo si recibe denuncias fundadas","Solo si el porcentaje de aptos es muy bajo","Ningún control posterior"], correct:0, explanation:"La Administración debe comprobar periódicamente que la empresa CAP sigue cumpliendo todas las condiciones de autorización." },
  { id:139, category:"Transporte y Regulación", danger:false, q:"La norma de que conductores con MMA > 7,5 t no participen en carga/descarga NO se aplica en:", options:["Transporte de mercancías frágiles","Transporte de mercancía paletizada","Transporte de materiales de construcción a pie de obra","Transporte de animales en puestos de control"], correct:2, explanation:"La excepción se aplica al transporte de materiales de construcción a pie de obra, donde el conductor puede participar." },
  { id:140, category:"Consumo y Eficiencia", danger:false, q:"¿Cómo puede optimizarse el consumo de carburante?", options:["Circular en punto muerto siempre que sea posible","Reducir mucho la relación de transmisión","Conducir lo más revolucionado posible","Conducir con la relación de marchas más larga posible"], correct:3, explanation:"Usar la marcha más larga posible mantiene las RPM bajas, optimizando el consumo de combustible." },,
];

// ─── CONCEPT LIBRARY ───
const CONCEPTS = [
  { title:"Categorías de Vehículos", icon:"Truck", items:["M = Transporte de personas", "N = Transporte de mercancías", "O = Remolques", "N1: MMA ≤ 3,5t · N2: 3,5-12t · N3: >12t", "O1: ≤0,75t · O2: 0,75-3,5t · O3: 3,5-10t · O4: >10t"] },
  { title:"Masas Máximas por Ejes", icon:"Weight", items:["Eje simple motor: 11,5 t", "Eje simple no motor: 10 t", "Eje tándem (<1m): 11,5 t", "Eje tándem (1-1,3m): 16 t", "Eje tándem (1,3-1,8m): 18 t (19 t con neum. dobles + susp. neumática)"] },
  { title:"MMA Camiones Rígidos", icon:"Truck", items:["2 ejes: 18 t", "3 ejes: 25 t (26 t con susp. neumática)", "4 ejes (2 direccionales + susp. neumática): 32 t", "4 ejes (otros): 31 t"] },
  { title:"Dimensiones Máximas", icon:"Truck", items:["Longitud camión rígido: 12 m", "Anchura general: 2,55 m", "Anchura vehículo acondicionado: 2,60 m", "Altura general: 4,00 m", "Altura portavehículos/auxilio: 4,50 m"] },
  { title:"Tiempos de Conducción (Reg. 561/2006)", icon:"Clock", items:["Conducción máx. diaria: 9 h (10 h × 2/semana)", "Conducción máx. semanal: 56 h", "Máx. 2 semanas consecutivas: 90 h", "Pausa obligatoria: 45 min tras 4,5 h", "Pausa divisible: 15 min + 30 min"] },
  { title:"Descansos (Reg. 561/2006)", icon:"Clock", items:["Descanso diario normal: ≥ 11 h", "Descanso diario reducido: ≥ 9 h (máx. 3/semana)", "Descanso semanal normal: ≥ 45 h", "Descanso semanal reducido: ≥ 24 h (compensar en 3 semanas)"] },
  { title:"Sistemas de Seguridad", icon:"Shield", items:["ABS: Antibloqueo de frenado", "EBS: Repartición electrónica de frenada", "ESP: Estabilización electrónica", "ASR: Control de tracción", "ACC: Control de crucero adaptativo", "AEBS: Frenada de emergencia automática"] },
  { title:"CAP - Datos Clave", icon:"Book", items:["Cualificación Inicial Ordinaria: 244 h", "Regulado por RD 284/2021", "Evaluación: Apto / No Apto", "20 h de conducción efectiva mínima", "Formación continua: 35 h cada 5 años"] },
];

// ─── RANKS ───
const RANKS = [
  { name:"Novato", minXP:0, emoji:"🔰" },
  { name:"Aprendiz", minXP:100, emoji:"🚛" },
  { name:"Conductor", minXP:300, emoji:"🛣️" },
  { name:"Profesional", minXP:600, emoji:"⭐" },
  { name:"Veterano", minXP:1000, emoji:"🏅" },
  { name:"Experto", minXP:1500, emoji:"🎖️" },
  { name:"Rey del Asfalto", minXP:2500, emoji:"👑" },
];

// ─── SRS ALGORITHM ───
function calcSRSWeight(card) {
  if (!card) return 1;
  const { correctCount=0, wrongCount=0, lastSeen=0 } = card;
  const daysSince = (Date.now() - lastSeen) / (1000*60*60*24);
  const errorRate = wrongCount / Math.max(1, correctCount + wrongCount);
  // More weight = more likely to appear
  return Math.max(0.1, (1 + errorRate * 3) * (1 + Math.min(daysSince, 7) * 0.3));
}

function pickWeightedQuestions(questions, cardData, count) {
  const weighted = questions.map(q => ({ q, weight: calcSRSWeight(cardData[q.id]) }));
  const totalWeight = weighted.reduce((s,w) => s + w.weight, 0);
  const picked = [];
  const available = [...weighted];

  while (picked.length < count && available.length > 0) {
    let r = Math.random() * available.reduce((s,w) => s + w.weight, 0);
    for (let i = 0; i < available.length; i++) {
      r -= available[i].weight;
      if (r <= 0) {
        picked.push(available[i].q);
        available.splice(i, 1);
        break;
      }
    }
  }
  return picked;
}

// ─── STORAGE HELPERS ───
const STORAGE_KEY = 'rutapro_data';
function loadData() {
  try {
    const d = JSON.parse(localStorage.getItem(STORAGE_KEY));
    return d || defaultData();
  } catch { return defaultData(); }
}
function defaultData() {
  return { xp:0, streak:0, lastStudyDate:null, totalCorrect:0, totalWrong:0, testsCompleted:0, cards:{}, dailyHistory:[] };
}
function saveData(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

// ─── MAIN APP ───
function App() {
  const [page, setPage] = useState('dashboard');
  const [data, setData] = useState(loadData);

  useEffect(() => { saveData(data); }, [data]);

  const updateData = useCallback((updater) => {
    setData(prev => {
      const next = typeof updater === 'function' ? updater(prev) : { ...prev, ...updater };
      return next;
    });
  }, []);

  const currentRank = useMemo(() => {
    let r = RANKS[0];
    for (const rank of RANKS) { if (data.xp >= rank.minXP) r = rank; }
    return r;
  }, [data.xp]);

  const nextRank = useMemo(() => {
    for (const rank of RANKS) { if (data.xp < rank.minXP) return rank; }
    return null;
  }, [data.xp]);

  const failedQuestions = useMemo(() => {
    return QUESTIONS.filter(q => {
      const c = data.cards[q.id];
      return c && c.wrongCount > 0 && (c.wrongCount >= c.correctCount);
    });
  }, [data.cards]);

  const dangerQuestions = useMemo(() => QUESTIONS.filter(q => q.danger), []);

  return (
    <div className="min-h-screen">
      {/* Top nav bar */}
      <nav className="glass sticky top-0 z-50 border-b border-white/5">
        <div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
          <div className="flex items-center gap-3 cursor-pointer" onClick={() => setPage('dashboard')}>
            <div className="w-9 h-9 rounded-lg bg-gradient-to-br from-yellow-400 to-amber-600 flex items-center justify-center">
              <Icons.Truck size={18} />
            </div>
            <div>
              <span className="font-display text-sm font-bold tracking-tight text-yellow-400">RUTA</span>
              <span className="font-display text-sm font-bold tracking-tight text-white">PRO</span>
            </div>
          </div>
          <div className="flex items-center gap-2 text-xs">
            <span className="text-xl">{currentRank.emoji}</span>
            <span className="font-display text-yellow-400 font-semibold">{currentRank.name}</span>
            <span className="text-asphalt-400 mx-1">·</span>
            <span className="text-amber-400 font-display font-semibold">{data.xp} XP</span>
            {data.streak > 0 && (
              <span className="flex items-center gap-1 ml-2 text-orange-400">
                <Icons.Flame size={14}/> {data.streak}
              </span>
            )}
          </div>
        </div>
        <div className="road-stripe"></div>
      </nav>

      {/* Bottom mobile nav */}
      <div className="fixed bottom-0 left-0 right-0 z-50 glass border-t border-white/5 md:hidden">
        <div className="flex justify-around py-2">
          {[
            { id:'dashboard', icon:Icons.Home, label:'Inicio' },
            { id:'test', icon:Icons.Play, label:'Test' },
            { id:'danger', icon:Icons.AlertTriangle, label:'Peligro' },
            { id:'library', icon:Icons.Book, label:'Biblio' },
            { id:'resources', icon:Icons.Globe, label:'Enlaces' },
            { id:'stats', icon:Icons.Chart, label:'Stats' },
          ].map(tab => (
            <button key={tab.id} onClick={() => setPage(tab.id)}
              className={`flex flex-col items-center gap-0.5 px-3 py-1 rounded-lg transition-colors ${page===tab.id ? 'text-yellow-400' : 'text-asphalt-400'}`}>
              <tab.icon size={18}/>
              <span className="text-[10px] font-medium">{tab.label}</span>
            </button>
          ))}
        </div>
      </div>

      {/* Main content */}
      <main className="max-w-6xl mx-auto px-4 py-6 pb-24 md:pb-6">
        {page === 'dashboard' && <Dashboard data={data} currentRank={currentRank} nextRank={nextRank} failedCount={failedQuestions.length} setPage={setPage} updateData={updateData}/>}
        {page === 'test' && <TestMode questions={QUESTIONS} data={data} updateData={updateData} setPage={setPage} mode="test"/>}
        {page === 'review' && <TestMode questions={failedQuestions.length > 0 ? failedQuestions : QUESTIONS} data={data} updateData={updateData} setPage={setPage} mode="review"/>}
        {page === 'danger' && <TestMode questions={dangerQuestions} data={data} updateData={updateData} setPage={setPage} mode="danger"/>}
        {page === 'library' && <Library/>}
        {page === 'resources' && <Resources/>}
        {page === 'stats' && <Stats data={data} updateData={updateData}/>}
      </main>
    </div>
  );
}

// ─── DASHBOARD ───
function Dashboard({ data, currentRank, nextRank, failedCount, setPage, updateData }) {
  const totalAnswered = data.totalCorrect + data.totalWrong;
  const accuracy = totalAnswered > 0 ? Math.round((data.totalCorrect / totalAnswered)*100) : 0;
  const progress = nextRank ? Math.min(100, ((data.xp - currentRank.minXP) / (nextRank.minXP - currentRank.minXP))*100) : 100;

  // Check streak
  useEffect(() => {
    const today = new Date().toDateString();
    if (data.lastStudyDate && data.lastStudyDate !== today) {
      const last = new Date(data.lastStudyDate);
      const diff = Math.floor((new Date(today) - last) / (1000*60*60*24));
      if (diff > 1 && data.streak > 0) {
        updateData(p => ({ ...p, streak: 0 }));
      }
    }
  }, []);

  return (
    <div className="space-y-6 animate-fade">
      {/* Hero */}
      <div className="glass rounded-2xl p-6 glow-card">
        <div className="flex flex-col md:flex-row md:items-center gap-4">
          <div className="flex-1">
            <h1 className="font-display text-2xl md:text-3xl font-bold mb-1">
              <span className="text-yellow-400">CAP</span> & <span className="text-white">Permiso C</span>
            </h1>
            <p className="text-asphalt-300 text-sm">Plataforma de estudio con repetición espaciada · 140 preguntas · Incluye examen real CAP 01/2026</p>
          </div>
          <div className="text-center">
            <div className="text-4xl mb-1">{currentRank.emoji}</div>
            <div className="font-display text-yellow-400 font-bold text-sm">{currentRank.name}</div>
            {nextRank && (
              <div className="mt-2 w-32">
                <div className="h-1.5 bg-asphalt-800 rounded-full overflow-hidden">
                  <div className="h-full bg-gradient-to-r from-yellow-500 to-amber-400 rounded-full transition-all duration-700" style={{width:`${progress}%`}}></div>
                </div>
                <div className="text-[10px] text-asphalt-400 mt-1">{data.xp}/{nextRank.minXP} XP → {nextRank.emoji} {nextRank.name}</div>
              </div>
            )}
          </div>
        </div>
      </div>

      {/* Quick stats */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
        {[
          { label:'Precisión', value:`${accuracy}%`, color:'text-green-400', icon:Icons.Check },
          { label:'Respondidas', value:totalAnswered, color:'text-blue-400', icon:Icons.Zap },
          { label:'Tests', value:data.testsCompleted, color:'text-purple-400', icon:Icons.Trophy },
          { label:'Racha', value:`${data.streak} días`, color:'text-orange-400', icon:Icons.Flame },
        ].map((s,i) => (
          <div key={i} className="glass rounded-xl p-4">
            <div className="flex items-center gap-2 mb-2">
              <s.icon size={14} />
              <span className="text-asphalt-400 text-xs font-medium">{s.label}</span>
            </div>
            <div className={`font-display text-xl font-bold ${s.color}`}>{s.value}</div>
          </div>
        ))}
      </div>

      {/* Action cards */}
      <div className="grid md:grid-cols-2 gap-4">
        <button onClick={() => setPage('test')}
          className="glass rounded-xl p-5 text-left hover:border-yellow-500/30 transition-all group">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 rounded-lg bg-yellow-500/10 flex items-center justify-center text-yellow-400 group-hover:bg-yellow-500/20 transition-colors">
              <Icons.Play size={20}/>
            </div>
            <div>
              <h3 className="font-display font-bold text-white">Modo Test</h3>
              <p className="text-xs text-asphalt-400">20 preguntas aleatorias con SRS</p>
            </div>
          </div>
        </button>

        <button onClick={() => setPage('review')}
          className="glass rounded-xl p-5 text-left hover:border-blue-500/30 transition-all group">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center text-blue-400 group-hover:bg-blue-500/20 transition-colors">
              <Icons.RefreshCw size={20}/>
            </div>
            <div>
              <h3 className="font-display font-bold text-white">Modo Repaso</h3>
              <p className="text-xs text-asphalt-400">{failedCount > 0 ? `${failedCount} preguntas falladas pendientes` : 'Todas correctas — repaso general'}</p>
            </div>
          </div>
        </button>

        <button onClick={() => setPage('danger')}
          className="glass rounded-xl p-5 text-left hover:border-red-500/30 transition-all group">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 rounded-lg bg-red-500/10 flex items-center justify-center text-red-400 group-hover:bg-red-500/20 transition-colors">
              <Icons.AlertTriangle size={20}/>
            </div>
            <div>
              <h3 className="font-display font-bold text-white">Zona de Peligro</h3>
              <p className="text-xs text-asphalt-400">Tacógrafo · Tiempos · Masas y Dimensiones</p>
            </div>
          </div>
        </button>

        <button onClick={() => setPage('library')}
          className="glass rounded-xl p-5 text-left hover:border-green-500/30 transition-all group">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 rounded-lg bg-green-500/10 flex items-center justify-center text-green-400 group-hover:bg-green-500/20 transition-colors">
              <Icons.Book size={20}/>
            </div>
            <div>
              <h3 className="font-display font-bold text-white">Biblioteca</h3>
              <p className="text-xs text-asphalt-400">Fichas de conceptos clave</p>
            </div>
          </div>
        </button>
      </div>

      {/* Recursos de Élite */}
      <button onClick={() => setPage('resources')}
        className="w-full glass rounded-xl p-5 text-left hover:border-cyan-500/30 transition-all group border border-cyan-900/20">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-500/10 to-blue-500/10 flex items-center justify-center text-cyan-400 group-hover:from-cyan-500/20 group-hover:to-blue-500/20 transition-colors">
            <Icons.Globe size={20}/>
          </div>
          <div className="flex-1">
            <h3 className="font-display font-bold text-white">Recursos de Élite</h3>
            <p className="text-xs text-asphalt-400">Simuladores oficiales, tests y enlaces estratégicos para preparar el CAP y Permiso C</p>
          </div>
          <Icons.ExternalLink size={16} className="text-asphalt-500 group-hover:text-cyan-400 transition-colors"/>
        </div>
      </button>

      {/* Danger zone preview */}
      <div className="glass rounded-xl p-5 border-red-900/30">
        <div className="flex items-center gap-2 mb-3">
          <div className="danger-badge px-2 py-0.5 rounded text-[10px] font-display font-bold text-white tracking-wider">ZONA DE PELIGRO</div>
          <span className="text-xs text-asphalt-400">Temas que más caen en el examen</span>
        </div>
        <div className="grid grid-cols-3 gap-3">
          {['Tacógrafo','Tiempos de Conducción','Masas y Dimensiones'].map((topic,i) => {
            const topicQs = QUESTIONS.filter(q => q.category === topic);
            const answered = topicQs.filter(q => data.cards[q.id]);
            const correct = topicQs.filter(q => data.cards[q.id]?.correctCount > data.cards[q.id]?.wrongCount);
            const pct = answered.length > 0 ? Math.round((correct.length/topicQs.length)*100) : 0;
            return (
              <div key={i} className="bg-asphalt-900/50 rounded-lg p-3 text-center">
                <div className={`font-display text-lg font-bold ${pct >= 70 ? 'text-green-400' : pct >= 40 ? 'text-yellow-400' : 'text-red-400'}`}>{pct}%</div>
                <div className="text-[10px] text-asphalt-400 mt-0.5">{topic}</div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}

// ─── TEST MODE ───
function TestMode({ questions, data, updateData, setPage, mode }) {
  const [testQuestions, setTestQuestions] = useState([]);
  const [current, setCurrent] = useState(0);
  const [selected, setSelected] = useState(null);
  const [revealed, setRevealed] = useState(false);
  const [results, setResults] = useState([]);
  const [finished, setFinished] = useState(false);
  const [shakeWrong, setShakeWrong] = useState(false);

  useEffect(() => {
    const count = mode === 'danger' ? Math.min(16, questions.length) : Math.min(20, questions.length);
    const picked = pickWeightedQuestions(questions, data.cards, count);
    // Shuffle
    for (let i = picked.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [picked[i], picked[j]] = [picked[j], picked[i]];
    }
    setTestQuestions(picked);
  }, []);

  const handleSelect = (idx) => {
    if (revealed) return;
    setSelected(idx);
  };

  const handleConfirm = () => {
    if (selected === null) return;
    const q = testQuestions[current];
    const isCorrect = selected === q.correct;

    if (!isCorrect) {
      setShakeWrong(true);
      setTimeout(() => setShakeWrong(false), 500);
    }

    setRevealed(true);
    setResults(prev => [...prev, { qId: q.id, correct: isCorrect }]);

    // Update SRS card data
    updateData(prev => {
      const cards = { ...prev.cards };
      const card = cards[q.id] || { correctCount:0, wrongCount:0, lastSeen:0 };
      cards[q.id] = {
        correctCount: card.correctCount + (isCorrect ? 1 : 0),
        wrongCount: card.wrongCount + (isCorrect ? 0 : 1),
        lastSeen: Date.now()
      };

      const today = new Date().toDateString();
      let streak = prev.streak;
      if (prev.lastStudyDate !== today) {
        const last = prev.lastStudyDate ? new Date(prev.lastStudyDate) : null;
        const diff = last ? Math.floor((new Date(today) - last) / (1000*60*60*24)) : 2;
        streak = diff <= 1 ? prev.streak + 1 : 1;
      }

      return {
        ...prev,
        cards,
        totalCorrect: prev.totalCorrect + (isCorrect ? 1 : 0),
        totalWrong: prev.totalWrong + (isCorrect ? 0 : 1),
        xp: prev.xp + (isCorrect ? 10 : 2),
        lastStudyDate: today,
        streak,
      };
    });
  };

  const handleNext = () => {
    if (current + 1 >= testQuestions.length) {
      updateData(prev => ({ ...prev, testsCompleted: prev.testsCompleted + 1, xp: prev.xp + 25 }));
      setFinished(true);
    } else {
      setCurrent(current + 1);
      setSelected(null);
      setRevealed(false);
    }
  };

  if (testQuestions.length === 0) return <div className="text-center py-20 text-asphalt-400">Cargando preguntas...</div>;

  if (finished) {
    const correctCount = results.filter(r => r.correct).length;
    const pct = Math.round((correctCount / results.length)*100);
    return (
      <div className="max-w-xl mx-auto animate-slide-up">
        <div className="glass rounded-2xl p-8 text-center">
          <div className={`text-6xl mb-4 ${pct >= 70 ? 'animate-confetti' : ''}`}>{pct >= 90 ? '🏆' : pct >= 70 ? '✅' : pct >= 50 ? '📘' : '💪'}</div>
          <h2 className="font-display text-2xl font-bold mb-2">{pct >= 70 ? '¡Gran resultado!' : 'Sigue practicando'}</h2>
          <div className="text-5xl font-display font-bold mb-1">
            <span className={pct >= 70 ? 'text-green-400' : pct >= 50 ? 'text-yellow-400' : 'text-red-400'}>{pct}%</span>
          </div>
          <p className="text-asphalt-400 text-sm mb-6">{correctCount} de {results.length} correctas · +{correctCount*10 + 25} XP</p>

          <div className="space-y-2 mb-6 max-h-60 overflow-y-auto">
            {results.map((r, i) => {
              const q = QUESTIONS.find(qq => qq.id === r.qId);
              return (
                <div key={i} className={`flex items-center gap-2 text-left text-xs px-3 py-2 rounded-lg ${r.correct ? 'bg-green-500/10 text-green-300' : 'bg-red-500/10 text-red-300'}`}>
                  {r.correct ? <Icons.Check size={14}/> : <Icons.X size={14}/>}
                  <span className="truncate">{q?.q}</span>
                </div>
              );
            })}
          </div>

          <div className="flex gap-3 justify-center">
            <button onClick={() => setPage('dashboard')} className="px-5 py-2.5 rounded-lg bg-asphalt-800 text-sm font-medium hover:bg-asphalt-700 transition-colors">Volver</button>
            <button onClick={() => { setFinished(false); setCurrent(0); setSelected(null); setRevealed(false); setResults([]); const count = mode === 'danger' ? Math.min(16, questions.length) : Math.min(20, questions.length); setTestQuestions(pickWeightedQuestions(questions, data.cards, count)); }}
              className="px-5 py-2.5 rounded-lg bg-yellow-500 text-black text-sm font-bold hover:bg-yellow-400 transition-colors">Repetir</button>
          </div>
        </div>
      </div>
    );
  }

  const q = testQuestions[current];
  const modeLabel = mode === 'danger' ? 'ZONA DE PELIGRO' : mode === 'review' ? 'REPASO' : 'TEST';
  const modeColor = mode === 'danger' ? 'text-red-400' : mode === 'review' ? 'text-blue-400' : 'text-yellow-400';

  return (
    <div className="max-w-2xl mx-auto animate-fade">
      {/* Progress bar */}
      <div className="flex items-center gap-3 mb-4">
        <button onClick={() => setPage('dashboard')} className="text-asphalt-400 hover:text-white transition-colors text-sm">✕</button>
        <div className="flex-1 h-2 bg-asphalt-800 rounded-full overflow-hidden">
          <div className="h-full bg-gradient-to-r from-yellow-500 to-amber-400 rounded-full transition-all duration-500"
            style={{width:`${((current+1)/testQuestions.length)*100}%`}}></div>
        </div>
        <span className="font-display text-xs text-asphalt-400">{current+1}/{testQuestions.length}</span>
      </div>

      {/* Category badge */}
      <div className="flex items-center gap-2 mb-4">
        <span className={`font-display text-[10px] font-bold tracking-widest ${modeColor}`}>{modeLabel}</span>
        <span className="text-asphalt-600">·</span>
        <span className="text-xs text-asphalt-400">{q.category}</span>
        {q.danger && <span className="danger-badge text-[9px] px-1.5 py-0.5 rounded font-bold text-white">⚠ CRÍTICO</span>}
      </div>

      {/* Question */}
      <div className={`glass rounded-xl p-6 mb-4 ${shakeWrong ? 'animate-shake' : ''}`}>
        <h2 className="font-body text-lg md:text-xl font-semibold leading-relaxed">{q.q}</h2>
      </div>

      {/* Options */}
      <div className="space-y-3 mb-6">
        {q.options.map((opt, idx) => {
          let cls = 'option-btn';
          if (revealed) {
            if (idx === q.correct) cls += ' correct';
            else if (idx === selected && idx !== q.correct) cls += ' wrong';
          } else if (idx === selected) {
            cls += ' selected';
          }
          return (
            <button key={idx} onClick={() => handleSelect(idx)}
              className={`${cls} w-full text-left rounded-xl px-5 py-4 flex items-center gap-3 bg-asphalt-950/50`}>
              <span className="w-8 h-8 rounded-lg bg-asphalt-800 flex items-center justify-center font-display text-sm font-bold text-asphalt-300 shrink-0">
                {String.fromCharCode(65+idx)}
              </span>
              <span className="text-sm md:text-base">{opt}</span>
              {revealed && idx === q.correct && <Icons.Check size={18} />}
              {revealed && idx === selected && idx !== q.correct && <Icons.X size={18}/>}
            </button>
          );
        })}
      </div>

      {/* Explanation */}
      {revealed && (
        <div className="glass rounded-xl p-5 mb-4 border-l-4 border-yellow-500 animate-slide-up">
          <p className="text-sm text-asphalt-200"><span className="text-yellow-400 font-bold">Explicación:</span> {q.explanation}</p>
        </div>
      )}

      {/* Action button */}
      <div className="flex justify-center">
        {!revealed ? (
          <button onClick={handleConfirm} disabled={selected === null}
            className={`px-8 py-3 rounded-xl font-display font-bold text-sm transition-all ${selected !== null ? 'bg-yellow-500 text-black hover:bg-yellow-400' : 'bg-asphalt-800 text-asphalt-500 cursor-not-allowed'}`}>
            Comprobar
          </button>
        ) : (
          <button onClick={handleNext}
            className="px-8 py-3 rounded-xl bg-yellow-500 text-black font-display font-bold text-sm hover:bg-yellow-400 transition-all">
            {current + 1 >= testQuestions.length ? 'Ver Resultados' : 'Siguiente →'}
          </button>
        )}
      </div>
    </div>
  );
}

// ─── LIBRARY ───
function Library() {
  const [expanded, setExpanded] = useState(null);
  const iconMap = { Truck:Icons.Truck, Weight:Icons.Weight, Clock:Icons.Clock, Shield:Icons.Shield, Book:Icons.Book };

  return (
    <div className="max-w-3xl mx-auto animate-fade">
      <div className="flex items-center gap-3 mb-6">
        <Icons.Book size={24}/>
        <h2 className="font-display text-xl font-bold">Biblioteca de Conceptos</h2>
      </div>
      <div className="space-y-3">
        {CONCEPTS.map((c, i) => {
          const IconComp = iconMap[c.icon] || Icons.Book;
          const isOpen = expanded === i;
          return (
            <div key={i} className="glass rounded-xl overflow-hidden">
              <button onClick={() => setExpanded(isOpen ? null : i)}
                className="w-full text-left px-5 py-4 flex items-center gap-3 hover:bg-white/[0.02] transition-colors">
                <div className="w-9 h-9 rounded-lg bg-yellow-500/10 flex items-center justify-center text-yellow-400 shrink-0">
                  <IconComp size={18}/>
                </div>
                <span className="font-display font-semibold text-sm flex-1">{c.title}</span>
                <span className={`text-asphalt-400 transition-transform ${isOpen ? 'rotate-180' : ''}`}>▾</span>
              </button>
              {isOpen && (
                <div className="px-5 pb-4 animate-slide-up">
                  <div className="border-t border-white/5 pt-3 space-y-2">
                    {c.items.map((item, j) => (
                      <div key={j} className="flex items-start gap-2 text-sm">
                        <span className="text-yellow-500 mt-1 shrink-0">▸</span>
                        <span className="text-asphalt-200">{item}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
}

// ─── RESOURCES ───
function Resources() {
  const resources = [
    {
      name: "Simulador Oficial MITMA (CAP)",
      url: "https://www.transportes.gob.es/transporte-terrestre/examenes-y-formacion/examenes-de-formacion-de-conductores-profesionales-cap",
      desc: "La fuente de verdad del Ministerio. Preguntas reales de examen CAP actualizadas.",
      icon: Icons.GraduationCap,
      color: "from-amber-500/15 to-yellow-500/15",
      hoverBorder: "hover:border-amber-500/40",
      iconColor: "text-amber-400",
      tag: "OFICIAL",
      tagColor: "bg-amber-500/20 text-amber-300",
    },
    {
      name: "TodoTest — Permiso C",
      url: "https://www.todotest.com/tests/test_camion_idx.asp?t=21",
      desc: "El estándar del sector para el examen teórico del permiso de camión. Miles de preguntas.",
      icon: Icons.FileText,
      color: "from-blue-500/15 to-indigo-500/15",
      hoverBorder: "hover:border-blue-500/40",
      iconColor: "text-blue-400",
      tag: "POPULAR",
      tagColor: "bg-blue-500/20 text-blue-300",
    },
    {
      name: "ExamenCAP.es — Mercancías",
      url: "https://examencap.es/mercancias",
      desc: "Ideal para repasar por módulos específicos de mercancías. Organizado por bloques temáticos.",
      icon: Icons.Truck,
      color: "from-green-500/15 to-emerald-500/15",
      hoverBorder: "hover:border-green-500/40",
      iconColor: "text-green-400",
      tag: "MODULAR",
      tagColor: "bg-green-500/20 text-green-300",
    },
    {
      name: "PracticaTest",
      url: "https://practicatest.com/",
      desc: "Manuales online y explicaciones detalladas de cada fallo. Perfecto para entender el porqué.",
      icon: Icons.Book,
      color: "from-purple-500/15 to-fuchsia-500/15",
      hoverBorder: "hover:border-purple-500/40",
      iconColor: "text-purple-400",
      tag: "APRENDE",
      tagColor: "bg-purple-500/20 text-purple-300",
    },
    {
      name: "DrivenYou — C1/C Tests",
      url: "https://www.drivenyou.com/permiso-c1-c/tests-examen-dgt/1",
      desc: "Interfaz limpia para tests rápidos de última hornada. Tests actualizados con formato DGT.",
      icon: Icons.Monitor,
      color: "from-cyan-500/15 to-teal-500/15",
      hoverBorder: "hover:border-cyan-500/40",
      iconColor: "text-cyan-400",
      tag: "RÁPIDO",
      tagColor: "bg-cyan-500/20 text-cyan-300",
    },
  ];

  return (
    <div className="max-w-3xl mx-auto animate-fade">
      {/* Header */}
      <div className="flex items-center gap-3 mb-2">
        <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 flex items-center justify-center text-cyan-400">
          <Icons.Sparkles size={22}/>
        </div>
        <div>
          <h2 className="font-display text-xl font-bold">Recursos de Élite</h2>
          <p className="text-xs text-asphalt-400">Enlaces oficiales y plataformas verificadas para tu preparación</p>
        </div>
      </div>

      <div className="road-stripe my-5 rounded-full"></div>

      {/* Resource cards */}
      <div className="space-y-3 mb-6">
        {resources.map((r, i) => (
          <a key={i} href={r.url} target="_blank" rel="noopener noreferrer"
            className={`glass rounded-xl p-5 flex items-start gap-4 transition-all ${r.hoverBorder} group block cursor-pointer`}
            style={{animationDelay: `${i * 80}ms`}}>
            <div className={`w-11 h-11 rounded-xl bg-gradient-to-br ${r.color} flex items-center justify-center ${r.iconColor} shrink-0 group-hover:scale-110 transition-transform`}>
              <r.icon size={20}/>
            </div>
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2 mb-1 flex-wrap">
                <h3 className="font-display font-bold text-sm text-white group-hover:text-yellow-300 transition-colors">{r.name}</h3>
                <span className={`${r.tagColor} text-[9px] font-display font-bold px-1.5 py-0.5 rounded tracking-wider`}>{r.tag}</span>
              </div>
              <p className="text-xs text-asphalt-300 leading-relaxed">{r.desc}</p>
            </div>
            <div className="text-asphalt-600 group-hover:text-cyan-400 transition-colors shrink-0 mt-1">
              <Icons.ExternalLink size={16}/>
            </div>
          </a>
        ))}
      </div>

      {/* Internet notice */}
      <div className="flex items-center gap-3 px-4 py-3 rounded-xl bg-asphalt-900/50 border border-asphalt-800/50">
        <div className="text-asphalt-500 shrink-0">
          <Icons.Globe size={16}/>
        </div>
        <p className="text-[11px] text-asphalt-400">
          <span className="text-asphalt-300 font-medium">Nota:</span> Estos recursos son externos y requieren conexión a internet. RutaPro no se hace responsable de su contenido o disponibilidad.
        </p>
      </div>

      {/* Tip card */}
      <div className="glass rounded-xl p-5 mt-4 border-l-4 border-yellow-500/50">
        <div className="flex items-start gap-3">
          <Icons.Zap size={18} className="text-yellow-400 shrink-0 mt-0.5"/>
          <div>
            <h4 className="font-display text-xs font-bold text-yellow-400 mb-1">CONSEJO PRO</h4>
            <p className="text-xs text-asphalt-300 leading-relaxed">Combina el estudio con RutaPro (repetición espaciada) + los tests del Simulador MITMA para preguntas reales. Usa TodoTest para simular el examen completo del Permiso C y ExamenCAP para repasar módulos específicos donde falles.</p>
          </div>
        </div>
      </div>
    </div>
  );
}

// ─── STATS ───
function Stats({ data, updateData }) {
  const chartRef = useRef(null);
  const chartInstance = useRef(null);
  const fileInputRef = useRef(null);

  const categories = useMemo(() => {
    const cats = {};
    QUESTIONS.forEach(q => {
      if (!cats[q.category]) cats[q.category] = { total:0, correct:0, wrong:0 };
      cats[q.category].total++;
      const card = data.cards[q.id];
      if (card) {
        cats[q.category].correct += card.correctCount || 0;
        cats[q.category].wrong += card.wrongCount || 0;
      }
    });
    return cats;
  }, [data.cards]);

  useEffect(() => {
    if (!chartRef.current) return;
    if (chartInstance.current) chartInstance.current.destroy();

    const labels = Object.keys(categories);
    const correctData = labels.map(l => categories[l].correct);
    const wrongData = labels.map(l => categories[l].wrong);

    chartInstance.current = new Chart(chartRef.current, {
      type: 'bar',
      data: {
        labels,
        datasets: [
          { label:'Correctas', data:correctData, backgroundColor:'rgba(16,185,129,0.7)', borderRadius:4 },
          { label:'Incorrectas', data:wrongData, backgroundColor:'rgba(239,68,68,0.7)', borderRadius:4 },
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { labels: { color:'#8e8e9b', font: { family:'DM Sans', size:11 } } },
        },
        scales: {
          x: { ticks:{ color:'#5b5b68', font:{ family:'DM Sans', size:10 }, maxRotation:45 }, grid:{ color:'rgba(255,255,255,0.03)' } },
          y: { ticks:{ color:'#5b5b68', font:{ family:'DM Sans', size:10 } }, grid:{ color:'rgba(255,255,255,0.05)' } },
        }
      }
    });

    return () => { if (chartInstance.current) chartInstance.current.destroy(); };
  }, [categories]);

  const exportData = () => {
    const blob = new Blob([JSON.stringify(data, null, 2)], { type:'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `rutapro_backup_${new Date().toISOString().slice(0,10)}.json`;
    a.click(); URL.revokeObjectURL(url);
  };

  const importData = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (evt) => {
      try {
        const imported = JSON.parse(evt.target.result);
        if (imported.xp !== undefined && imported.cards !== undefined) {
          updateData(imported);
          alert('✅ Progreso importado correctamente');
        } else {
          alert('❌ El archivo no tiene el formato correcto');
        }
      } catch { alert('❌ Error al leer el archivo'); }
    };
    reader.readAsText(file);
  };

  const resetData = () => {
    if (confirm('⚠️ ¿Seguro que quieres borrar TODOS tus datos? Esta acción no se puede deshacer.')) {
      updateData(defaultData());
    }
  };

  return (
    <div className="max-w-3xl mx-auto space-y-6 animate-fade">
      <div className="flex items-center gap-3 mb-2">
        <Icons.Chart size={24}/>
        <h2 className="font-display text-xl font-bold">Estadísticas y Datos</h2>
      </div>

      {/* Chart */}
      <div className="glass rounded-xl p-5">
        <h3 className="font-display text-sm font-semibold mb-4 text-asphalt-300">Rendimiento por Categoría</h3>
        <div className="h-64">
          <canvas ref={chartRef}></canvas>
        </div>
      </div>

      {/* Category breakdown */}
      <div className="glass rounded-xl p-5">
        <h3 className="font-display text-sm font-semibold mb-4 text-asphalt-300">Desglose por Tema</h3>
        <div className="space-y-3">
          {Object.entries(categories).map(([cat, stats]) => {
            const total = stats.correct + stats.wrong;
            const pct = total > 0 ? Math.round((stats.correct/total)*100) : 0;
            return (
              <div key={cat} className="flex items-center gap-3">
                <span className="text-xs text-asphalt-300 w-40 truncate">{cat}</span>
                <div className="flex-1 h-2 bg-asphalt-800 rounded-full overflow-hidden">
                  <div className="h-full bg-gradient-to-r from-green-500 to-emerald-400 rounded-full transition-all" style={{width:`${pct}%`}}></div>
                </div>
                <span className={`font-display text-xs font-bold w-10 text-right ${pct >= 70 ? 'text-green-400' : pct >= 40 ? 'text-yellow-400' : 'text-red-400'}`}>{pct}%</span>
              </div>
            );
          })}
        </div>
      </div>

      {/* Data sovereignty */}
      <div className="glass rounded-xl p-5">
        <h3 className="font-display text-sm font-semibold mb-1 text-asphalt-300">Soberanía de Datos</h3>
        <p className="text-xs text-asphalt-500 mb-4">Tus datos son tuyos. Exporta, importa o restablece tu progreso.</p>
        <div className="flex flex-wrap gap-3">
          <button onClick={exportData} className="flex items-center gap-2 px-4 py-2.5 rounded-lg bg-green-500/10 text-green-400 text-sm font-medium hover:bg-green-500/20 transition-colors">
            <Icons.Download size={16}/> Exportar JSON
          </button>
          <button onClick={() => fileInputRef.current?.click()} className="flex items-center gap-2 px-4 py-2.5 rounded-lg bg-blue-500/10 text-blue-400 text-sm font-medium hover:bg-blue-500/20 transition-colors">
            <Icons.Upload size={16}/> Importar JSON
          </button>
          <input ref={fileInputRef} type="file" accept=".json" onChange={importData} className="hidden"/>
          <button onClick={resetData} className="flex items-center gap-2 px-4 py-2.5 rounded-lg bg-red-500/10 text-red-400 text-sm font-medium hover:bg-red-500/20 transition-colors">
            <Icons.X size={16}/> Restablecer todo
          </button>
        </div>
      </div>

      {/* Footer credits */}
      <div className="text-center py-4">
        <p className="text-[10px] text-asphalt-600 font-display">RUTAPRO v1.0 · Basado en Manual RVP 2024 · TMVI03 · TMVI21</p>
        <p className="text-[10px] text-asphalt-700 font-display mt-0.5">© 2026 COPYCAP666 · Todos los derechos reservados</p>
      </div>
    </div>
  );
}

// ─── RENDER ───
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
